(function(){function m(a){return 10>a?"0"+a:a}function q(a){r.lastIndex=0;return r.test(a)?'"'+a.replace(r,function(a){var c=s[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function o(a,b){var c,d,e,p,h=f,i,g=b[a];g&&"object"===typeof g&&"function"===typeof g.toJSON&&(g=g.toJSON(a));"function"===typeof j&&(g=j.call(b,a,g));switch(typeof g){case "string":return q(g);case "number":return isFinite(g)?""+g:"null";case "boolean":case "null":return""+
g;case "object":if(!g)return"null";f+=n;i=[];if("[object Array]"===Object.prototype.toString.apply(g)){p=g.length;for(c=0;c<p;c+=1)i[c]=o(c,g)||"null";e=0===i.length?"[]":f?"[\n"+f+i.join(",\n"+f)+"\n"+h+"]":"["+i.join(",")+"]";f=h;return e}if(j&&"object"===typeof j){p=j.length;for(c=0;c<p;c+=1)"string"===typeof j[c]&&(d=j[c],(e=o(d,g))&&i.push(q(d)+(f?": ":":")+e))}else for(d in g)Object.prototype.hasOwnProperty.call(g,d)&&(e=o(d,g))&&i.push(q(d)+(f?": ":":")+e);e=0===i.length?"{}":f?"{\n"+f+i.join(",\n"+
f)+"\n"+h+"}":"{"+i.join(",")+"}";f=h;return e}}function t(a,b,c){if(JSON&&JSON.stringify)return JSON.stringify(a,b,c);var d;n=f="";if("number"===typeof c)for(d=0;d<c;d+=1)n+=" ";else"string"===typeof c&&(n=c);if((j=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return o("",{"":a})}function u(){}function v(a){var b=a.length,c=0;b%4&&(a+="0000000".substr(0,4-b%4));for(var d=0,b=b/4;d<b;++d)for(var e=0;4>e;++e)c+=a.charCodeAt(4*d+e)<<8*e;return""+
Math.abs(c)%4294967295}function w(a,b){function c(){d||(d=!0,a.apply(b,arguments))}var d=!1,b=b||window;("interactive"===document.readyState||"complete"===document.readyState)&&c();if(document.addEventListener)document.addEventListener("DOMContentLoaded",c,!1);else if(document.attachEvent){if(document.documentElement.doScroll&&window.top){var e=function(){if(!d&&document.body)try{document.documentElement.doScroll("left"),c()}catch(a){setTimeout(e,0)}};e()}document.attachEvent("onreadystatechange",
function(){"complete"===document.readyState&&c()})}}Shiterator=function(a,b){if(this.constructor._Instance)return this.constructor._Instance;this.constructor._Instance=this;this.__callback=a||u;var c={host:null,port:6060,postingPeriod:5,forgetErrorsAfter:1,errorsLimit:10,stackTraceLimit:1024,ignoreBrowsers:{},acceptErrors:"all"},d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);this._options=c;this.__ShiteratorInit()};Shiterator.prototype.__ShiteratorInit=function(){this.__started=!1;this.__errorsToPost=
[];this.__knownErrors=new k(this._options.forgetErrorsAfter||365);this.__errorsCount=0;this.__form=this.__postErrorTimeout=null;new h(this.__errorHandler,this._options.ignoreBrowsers,this._options.acceptErrors,this)};Shiterator.prototype.__getFullUrl=function(){return this._options.host?(0!==this._options.host.indexOf("http://")?"http://":"")+this._options.host+(this._options.port?":"+this._options.port:""):null};Shiterator.prototype.__convertErrorToData=function(a,b,c,d){var e=this._options.stackTraceLimit||
1E6;return{type:"javascript",subject:a+" on "+b+":"+c,message:a,line:c,stack:d?d.toString().substring(0,e):"not available",tracker:{},file:b,custom:{url:document.location.href,referer:document.referrer}}};Shiterator.prototype.__errorHandler=function(a,b,c,d){if(!this.__started||this.__errorsCount>=this._options.errorsLimit)return!0;var e=this,f=v(a+" on "+b+":"+c),a=this.__convertErrorToData(a,b,c,d);this.__knownErrors.has(f)||(this.__callback.call(window,a),this.__knownErrors.put(f),this.__errorsToPost.push(a),
this.__errorsCount++,this.__postErrorTimeout||(this.__postErrorTimeout=setTimeout(function(){w(e.__submitErrors,e)},1E3*this._options.postingPeriod)));return!1};Shiterator.prototype.__submitErrors=function(){if(this.__getFullUrl()){if(!this.__form){var a=document.createElement("div");a.style.display="none";a.innerHTML='<form action="'+this.__getFullUrl()+'" method="post" target="shiterator-error-frame" name="shiterator-form"><input type=\'hidden\' name=\'errors\' value=\'\'></form><iframe id="shiterator-error-frame" name="shiterator-error-frame"></iframe>';
document.body.appendChild(a);this.__form=a.getElementsByTagName("form")[0]}var b=a.getElementsByTagName("iframe")[0],a=a.getElementsByTagName("input")[0],c=t(this.__errorsToPost);a.setAttribute("value",c);b.onload=function(){b.onload=null;self.stop()};document["shiterator-form"].submit()}};Shiterator.prototype.start=function(){this.__started=!0};Shiterator.prototype.stop=function(){this.__started&&(this.__errorsCount=this.__errorsToPost.length=0,this.__started=!1,clearTimeout(this.__postErrorTimeout))};
var k=function(a){this.__storage;this.__expires;this.__retrieveFromCookies(a)};k.prototype.__retrieveFromCookies=function(a){this.__storage=[];var b=this.__getCookie("shiterator");b&&(this.__storage=b.split("/"));(b=this.__storage.shift())||(b=new Date((new Date).getTime()+864E5*a));this.__expires=this.__expires=b};k.prototype.__setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime());d=new Date(c);document.cookie=a+"="+encodeURIComponent(b)+(c?";expires="+d.toGMTString():"")};k.prototype.__getCookie=
function(a){for(var b=document.cookie.split(";"),c="",d="",e="",f=b.length;f--;)if(c=b[f].split("="),d=c[0].replace(/^\s+|\s+$/g,""),d===a)return 1<c.length&&(e=decodeURIComponent(c[1].replace(/^\s+|\s+$/g,""))),e;return null};k.prototype.__storeInCookies=function(){this.__setCookie("shiterator",[this.__expires].concat(this.__storage).join("/"),this.__expires)};k.prototype.has=function(a){for(var b=this.__storage.length;b--;)if(this.__storage[b]===a)return!0;return!1};k.prototype.put=function(a){this.__storage.push(a);
this.__storeInCookies()};var h=function(a,b,c,d){for(var e in b)if(l[e]&&l.version<=b[e])return;this.__hostMatch=this.__createHostMatchRegExp(c);this.__handler=this.__createErrorHandler(a,d);l.webkit&&534.16>l.version?this.__useErrorToString():l.mozilla?this.__useHybrid():this.__useWindowOnError()};h.prototype.__isHostAccepted=function(a){return!!this.__hostMatch.exec(a)};h.prototype.__createHostMatchRegExp=function(a){var b=location.host;"string"!==typeof a&&!(a instanceof RegExp)&&(a=a.toString());
if("string"===typeof a)switch(a.toLowerCase()){case "all":a=RegExp("","i");break;case "domain":a=RegExp("^[^/]+:\\/\\/"+b+"(\\/|\\?|#)","i");break;case "subdomain":a=RegExp("^[^/]+:\\/\\/([^?#/. ]+\\.)*"+b+"(\\/|\\?|#)","i");break;default:a=RegExp(a,"")}return a};h.prototype.__useWindowOnError=function(){this.__previousErrorHandler=window.onerror;window.onerror=this.__handler};h.prototype.__useErrorToString=function(){var a=this;Error.prototype.toString=function(){a.__handleError(a.__getParamsFromErrorObject(this));
return this.message}};h.prototype.__useHybrid=function(){var a=this,b;Error.prototype.toString=function(){b=a.__getParamsFromErrorObject(this);return this.message};window.addEventListener("error",function(){a.__handleError(b)},!1)};h.prototype.__handleError=function(a){a&&this.__handler(a.message,a.file,a.line,a.trace)};h.prototype.__getParamsFromErrorObject=function(a){if(a.sourceURL)return{message:a.message,file:a.sourceURL,line:a.line};if(!a.stack)return null;var b=a.stack.match(/[a-z]+:\/\/[^:]+:\d+/)[0].split(":");
return{message:a.message,file:b[0]+":"+b[1],line:b[2],trace:a.stack}};h.prototype.__createErrorHandler=function(a,b){if("function"===typeof a){var c=this,b=b||window;return function(d,e,f){c.__previousErrorHandler&&c.__previousErrorHandler.apply(b,arguments);d&&e&&"undefined"!==typeof f&&c.__isHostAccepted(e)&&a.apply(b,arguments);return!!l.webkit}}};"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+m(this.getUTCMonth()+
1)+"-"+m(this.getUTCDate())+"T"+m(this.getUTCHours())+":"+m(this.getUTCMinutes())+":"+m(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var r=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,n,s={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j,l=function(){var a=/(opera)(?:.*version)?[ \/]([\w.]+)/,
b=/(msie) ([\w.]+)/,c=/(mozilla)(?:.*? rv:([\w.]+))?/,d=navigator.userAgent.toLowerCase(),a=/(webkit)[ \/]([\w.]+)/.exec(d)||a.exec(d)||b.exec(d)||d.indexOf("compatible")<0&&c.exec(d)||[],b={};b[a[1]||""]=true;b.version=parseFloat(a[2])||0;return b}()})();
